<!DOCTYPE html>
<html lang="en">
<head>
	<style>
		:root {
			--primary-bg:#1a1a1a;--secondary-bg:#202020;--accent-bg:#242424;--border-color:#45475a;--text-primary:#cdd6f4;--text-secondary:#6c7086;--accent-pink:#f38ba8;--accent-blue:#89b4fa;--accent-yellow:#f9e2af;--accent-green:#a6e3a1;--accent-purple:#cba6f7;--accent-cyan:#89dceb;--accent-orange:#fab387
		}
		*{box-sizing:border-box}
		html,body{background:linear-gradient(135deg,var(--primary-bg) 0%,var(--secondary-bg) 100%);width:100%;height:100%;margin:0;padding:0;overflow:hidden;font-family:'Cascadia Code','Fira Code','JetBrains Mono',consolas,monospace;color:var(--text-primary)}
		.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:var(--primary-bg);display:flex;align-items:center;justify-content:center;z-index:10000;transition:opacity .2s ease}
		.loading-spinner{width:32px;height:32px;border:2px solid rgba(137,180,250,.3);border-top:2px solid var(--accent-blue);border-radius:50%;animation:spin .8s linear infinite}
		@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
		.editor-container{width:100%;height:100%;display:flex;flex-direction:column;position:relative;opacity:0;transition:opacity .2s ease}
		.editor-container.loaded{opacity:1}
		.toolbar{background:linear-gradient(135deg,#1c1c1c,#252525);backdrop-filter:blur(10px);border-bottom:1px solid rgba(69,71,90,.5);padding:6px 12px;display:flex;align-items:center;justify-content:space-between;height:42px;z-index:1000;box-shadow:0 2px 10px rgba(0,0,0,.3)}
		.toolbar-section{display:flex;align-items:center;gap:8px}
		
		.toolbar-button{background:linear-gradient(145deg,#2a2a2a,#1f1f1f);border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:6px 10px;color:var(--text-primary);cursor:pointer;transition:all .15s ease;font-size:11px;font-weight:500;display:inline-flex;align-items:center;gap:6px;position:relative;overflow:hidden;letter-spacing:.3px;min-width:auto;height:30px}
		.toolbar-button:hover{background:linear-gradient(145deg,#3a3a3a,#2f2f2f);border-color:rgba(137,180,250,.3);transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
		.toolbar-button:active{transform:translateY(0);box-shadow:0 2px 8px rgba(0,0,0,.2)}
		.toolbar-button.active{background:linear-gradient(145deg,var(--accent-blue),#6c91f7);color:#fff;border-color:var(--accent-blue);box-shadow:0 0 12px rgba(137,180,250,.3)}
		.toolbar-button svg{width:14px;height:14px;fill:currentColor;transition:transform .15s ease}
		.toolbar-button:hover svg{transform:scale(1.05)}
		
		.ai-badge{background:linear-gradient(135deg,#1a1a1a,#2d2d2d);border:1px solid #4a4a4a;border-radius:4px;padding:5px 12px;font-size:10px;font-weight:700;letter-spacing:.5px;position:relative;overflow:hidden;cursor:pointer;transition:all .15s ease;display:inline-flex;align-items:center;height:26px;box-shadow:0 2px 8px rgba(0,0,0,.4);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
		.ai-badge span{background:linear-gradient(90deg,#ffffff,#808080,#ffffff,#c0c0c0,#ffffff);background-size:200% 100%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;font-size:10px;animation:gradientShift 2s ease-in-out infinite}
		@keyframes gradientShift{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
		.ai-badge:hover{transform:scale(1.02);background:linear-gradient(135deg,#2a2a2a,#3d3d3d);border-color:#6a6a6a}
		
		.status-bar{
			position:fixed;
			bottom:0;
			left:0;
			right:0;
			background:linear-gradient(135deg,#1f1f1f,#2a2a2a);
			backdrop-filter:blur(10px);
			border-top:1px solid rgba(69,71,90,.5);
			padding:6px 16px;
			display:flex;
			align-items:center;
			justify-content:space-between;
			height:30px;
			font-size:11px;
			color:var(--text-secondary);
			z-index:1001
		}
		.status-item{display:flex;align-items:center;gap:6px}
		.status-indicator{width:8px;height:8px;border-radius:50%;background:var(--accent-green);animation:pulse 2s infinite}
		@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
		.notification{position:fixed;bottom:50px;right:20px;background:linear-gradient(135deg,#2a2a2a,#1f1f1f);backdrop-filter:blur(10px);border:1px solid rgba(69,71,90,.6);border-radius:6px;padding:8px 12px;color:var(--text-primary);font-size:11px;font-weight:500;box-shadow:0 4px 16px rgba(0,0,0,.3);transform:translateX(400px);transition:transform .2s ease;z-index:10001;display:flex;align-items:center;gap:6px;min-width:150px;max-width:280px;height:32px}
		.notification.show{transform:translateX(0)}
		.notification-icon{width:14px;height:14px;fill:var(--accent-green);flex-shrink:0}
		.notification-close{margin-left:auto;cursor:pointer;width:12px;height:12px;fill:var(--text-secondary);transition:fill .15s ease;opacity:.7}
		.notification-close:hover{fill:var(--text-primary);opacity:1}
		.sidebar{position:absolute;left:0;top:42px;bottom:30px;width:280px;background:linear-gradient(145deg,rgba(26,26,26,.95),rgba(45,45,45,.95));backdrop-filter:blur(15px);border-right:1px solid rgba(74,74,74,.5);border-radius:0 12px 12px 0;box-shadow:4px 0 20px rgba(0,0,0,.4);transform:translateX(-100%);transition:transform .25s ease;z-index:999;overflow-y:auto}
		.sidebar.open{transform:translateX(0)}
		.sidebar-section{padding:20px 18px;border-bottom:1px solid rgba(74,74,74,.3);transition:background .15s ease}
		.sidebar-section:hover{background:rgba(255,255,255,.02)}
		.sidebar-section:last-child{border-bottom:none}
		.sidebar-title{color:#c0c0c0;font-weight:600;margin-bottom:16px;font-size:13px;letter-spacing:.5px;text-transform:uppercase;display:flex;align-items:center;gap:8px}
		.sidebar-title::before{content:'';width:3px;height:16px;background:linear-gradient(135deg,#c0c0c0,#808080);border-radius:2px}
		.setting-item{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding:12px 14px;font-size:12px;color:var(--text-primary);background:linear-gradient(145deg,#2a2a2a,#1f1f1f);border-radius:6px;border:1px solid rgba(74,74,74,.3);transition:all .15s ease;position:relative;overflow:hidden}
		.setting-item:hover{transform:translateX(4px);border-color:rgba(192,192,192,.3);background:linear-gradient(145deg,#3a3a3a,#2f2f2f)}
		.setting-item:last-child{margin-bottom:0}
		.setting-label{font-weight:500;color:#c0c0c0}
		.switch{position:relative;width:44px;height:24px;background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border:2px solid rgba(74,74,74,.4);border-radius:12px;cursor:pointer;transition:all .2s ease;box-shadow:inset 0 2px 4px rgba(0,0,0,.3)}
		.switch:hover{border-color:rgba(192,192,192,.4)}
		.switch.active{background:linear-gradient(135deg,#606060,#404040);border-color:#808080}
		.switch::after{content:'';position:absolute;top:2px;left:2px;width:16px;height:16px;background:linear-gradient(135deg,#c0c0c0,#a0a0a0);border-radius:50%;transition:transform .2s ease;box-shadow:0 2px 6px rgba(0,0,0,.3)}
		.switch.active::after{transform:translateX(20px);background:linear-gradient(135deg,#fff,#e0e0e0)}
		.range-input{width:100px;height:6px;background:linear-gradient(90deg,#2a2a2a,#1a1a1a);border:1px solid rgba(74,74,74,.4);border-radius:3px;outline:none;appearance:none;cursor:pointer;transition:border-color .2s ease}
		.range-input:hover{border-color:rgba(192,192,192,.4)}
		.range-input::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:linear-gradient(135deg,#c0c0c0,#808080);border:2px solid #fff;border-radius:50%;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.4);transition:transform .15s ease}
		.range-input::-webkit-slider-thumb:hover{transform:scale(1.1);background:linear-gradient(135deg,#e0e0e0,#a0a0a0)}
		.sidebar::-webkit-scrollbar{width:6px}
		.sidebar::-webkit-scrollbar-track{background:transparent}
		.sidebar::-webkit-scrollbar-thumb{background:linear-gradient(135deg,rgba(192,192,192,.3),rgba(192,192,192,.5));border-radius:3px}
		.sidebar::-webkit-scrollbar-thumb:hover{background:linear-gradient(135deg,rgba(192,192,192,.5),rgba(192,192,192,.7))}
		
		.editor-wrapper{
			flex:1;
			position:relative;
			padding-bottom:30px
		}
		#container{width:100%;height:100%;border-radius:0;box-shadow:inset 0 0 20px rgba(137,180,250,.06),inset 0 0 10px rgba(137,180,250,.03);border:1px solid rgba(137,180,250,.1)}
		.error-message{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#dc2626,#991b1b);color:#fff;padding:20px 30px;border-radius:10px;font-family:monospace;font-size:14px;max-width:80%;text-align:center;z-index:10001;box-shadow:0 10px 40px rgba(0,0,0,.5)}
		
		/* Snippet preview styling */
		.monaco-editor-overlaymessage {
			background: linear-gradient(135deg, #2a2a2a, #1f1f1f) !important;
			border: 1px solid rgba(137,180,250,.3) !important;
			box-shadow: 0 4px 12px rgba(0,0,0,.5) !important;
		}
		
		@media (max-width:768px){
			.toolbar{padding:4px 8px;height:38px}
			.toolbar-button{padding:5px 8px;font-size:10px;height:28px}
			.toolbar-button svg{width:12px;height:12px}
			.sidebar{width:240px}
			.notification{right:10px;bottom:45px;max-width:calc(100vw - 20px);font-size:10px;height:30px;padding:6px 10px}
			.ai-badge{padding:4px 6px;font-size:9px;height:24px}
		}
		.editor-container,.sidebar{contain:layout style}
		
		.toolbar-button::before{display:none}
		.ai-badge::after{display:none}
	</style>
	<meta charset="utf-8" />
	<title>Enhanced LuaU Editor with IntelliSense</title>
	<link rel="preconnect" href="https://cdnjs.cloudflare.com">
	<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
</head>
<body>
	<div class="loading-overlay" id="loadingOverlay">
		<div class="loading-spinner"></div>
	</div>
	<div class="editor-container" id="editorContainer">
		<div class="toolbar">
			<div class="toolbar-section">
				<div class="toolbar-button" onclick="toggleSidebar()" title="Settings">
					<svg viewBox="0 0 24 24"><path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/></svg>
				</div>
				<div class="toolbar-button" onclick="toggleMinimap()" title="Minimap">
					<svg viewBox="0 0 24 24"><path d="M15,7V3H9V7H3V9H21V7H15Z M21,11H3V21H21V11Z M9,19V13H15V19H9Z"/></svg>
				</div>
				<div class="toolbar-button" onclick="showSnippets()" title="Snippets Library">
					<svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M10,13L8,18L10,17L12,18L10,13M15,10L13,15L15,14L17,15L15,10Z"/></svg>
				</div>
			</div>
			<div class="toolbar-section">
				<div class="ai-badge" title="Enhanced with AI-powered IntelliSense and Roblox API documentation"><span>AI-Enhanced Editor</span></div>
			</div>
		</div>
		<div class="sidebar" id="sidebar">
			<div class="sidebar-section">
				<div class="sidebar-title">Editor Settings</div>
				<div class="setting-item">
					<span class="setting-label">Word Wrap</span>
					<div class="switch" onclick="toggleWordWrap(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Line Numbers</span>
					<div class="switch active" onclick="toggleLineNumbers(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Auto Save</span>
					<div class="switch active" onclick="toggleAutoSave(this)"></div>
				</div>
			</div>
			<div class="sidebar-section">
				<div class="sidebar-title">Appearance</div>
				<div class="setting-item">
					<span class="setting-label">Font Size</span>
					<input type="range" class="range-input" min="10" max="24" value="12" onchange="changeFontSize(this.value)">
				</div>
				<div class="setting-item">
					<span class="setting-label">Line Height</span>
					<input type="range" class="range-input" min="1" max="3" step="0.1" value="1.5" onchange="changeLineHeight(this.value)">
				</div>
			</div>
			<div class="sidebar-section">
				<div class="sidebar-title">LuaU Features</div>
				<div class="setting-item">
					<span class="setting-label">Auto Completion</span>
					<div class="switch active" onclick="toggleAutoCompletion(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Error Detection</span>
					<div class="switch active" onclick="toggleErrorDetection(this)"></div>
				</div>
				<div class="setting-item">
					<span class="setting-label">Type Hints</span>
					<div class="switch active" onclick="toggleTypeHints(this)"></div>
				</div>
			</div>
		</div>
		<div class="notification" id="customNotification">
			<svg class="notification-icon" viewBox="0 0 24 24">
				<path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/>
			</svg>
			<span id="notificationText"></span>
			<svg class="notification-close" viewBox="0 0 24 24" onclick="hideNotification()">
				<path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
			</svg>
		</div>
		<div class="editor-wrapper">
			<div id="container"></div>
		</div>
	</div>
	
	<div class="status-bar">
		<div class="status-item">
			<div class="status-indicator"></div>
			<span id="statusText">Initializing...</span>
		</div>
		<div style="display: flex; gap: 16px;">
			<div class="status-item">
				<span>Line: <span id="currentLine">1</span></span>
			</div>
			<div class="status-item">
				<span>Col: <span id="currentCol">1</span></span>
			</div>
			<div class="status-item">
				<span>LuaU</span>
			</div>
		</div>
	</div>
	<script src="browser-lsp.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.41.0/min/vs/loader.min.js"></script>
	<script>
		let editor,editorLoaded=false,statusTimeout,notificationTimeout,autoCompletionEnabled=true,typeHintsEnabled=true;
		const els={};
		
		// Comprehensive Roblox API Documentation
		const robloxAPIDocs = {
			// Core Game Services
			'game': {
				type: 'DataModel',
				description: 'The root of the Roblox object hierarchy. Contains all services and the workspace.',
				methods: ['GetService', 'FindService', 'GetObjects', 'Load'],
				example: 'local Players = game:GetService("Players")'
			},
			'workspace': {
				type: 'Workspace',
				description: 'Container for all 3D objects in the game world.',
				properties: ['CurrentCamera', 'Gravity', 'FallenPartsDestroyHeight'],
				methods: ['Raycast', 'FindPartOnRay', 'GetPartBoundsInBox'],
				example: 'workspace.Gravity = 196.2'
			},
			'Players': {
				type: 'Service',
				description: 'Service managing all players in the game.',
				properties: ['LocalPlayer', 'MaxPlayers', 'CharacterAutoLoads'],
				events: ['PlayerAdded', 'PlayerRemoving'],
				example: 'Players.PlayerAdded:Connect(function(player) end)'
			},
			'ReplicatedStorage': {
				type: 'Service',
				description: 'Storage accessible by both server and clients. Used for RemoteEvents/Functions.',
				usage: 'Store assets, RemoteEvents, and shared modules here.',
				example: 'local remote = ReplicatedStorage:WaitForChild("RemoteEvent")'
			},
			'ServerStorage': {
				type: 'Service',
				description: 'Storage only accessible by the server. Secure location for server-only assets.',
				security: 'Server-only access',
				example: 'local weapon = ServerStorage:FindFirstChild("Sword")'
			},
			'RunService': {
				type: 'Service',
				description: 'Service for managing game runtime and rendering loops.',
				events: ['Heartbeat', 'RenderStepped', 'Stepped'],
				methods: ['IsClient', 'IsServer', 'IsStudio'],
				example: 'RunService.Heartbeat:Connect(function(deltaTime) end)'
			},
			
			// Important Classes
			'Part': {
				type: 'Class',
				description: 'Basic 3D building block. Can have physics, collisions, and appearance.',
				properties: ['Position', 'Size', 'CFrame', 'Anchored', 'CanCollide', 'Transparency'],
				example: 'part.Position = Vector3.new(0, 10, 0)'
			},
			'Humanoid': {
				type: 'Class',
				description: 'Controls character movement, health, and animations.',
				properties: ['Health', 'MaxHealth', 'WalkSpeed', 'JumpPower'],
				events: ['Died', 'HealthChanged', 'StateChanged'],
				example: 'humanoid.WalkSpeed = 20'
			},
			'RemoteEvent': {
				type: 'Class',
				description: 'Allows one-way communication between server and clients.',
				methods: ['FireServer', 'FireClient', 'FireAllClients'],
				events: ['OnServerEvent', 'OnClientEvent'],
				example: 'remoteEvent:FireServer(data)'
			},
			'RemoteFunction': {
				type: 'Class',
				description: 'Allows two-way communication with return values.',
				methods: ['InvokeServer', 'InvokeClient'],
				callbacks: ['OnServerInvoke', 'OnClientInvoke'],
				example: 'local result = remoteFunction:InvokeServer(args)'
			},
			
			// Common Methods
			'GetService': {
				type: 'Method',
				returns: 'Service',
				description: 'Gets or creates a service by name. Preferred over direct access.',
				parameters: ['className: string'],
				example: 'local TweenService = game:GetService("TweenService")'
			},
			'WaitForChild': {
				type: 'Method',
				returns: 'Instance',
				description: 'Waits for a child with the given name. Yields until found.',
				parameters: ['name: string', 'timeout?: number'],
				example: 'local part = workspace:WaitForChild("ImportantPart", 10)'
			},
			'FindFirstChild': {
				type: 'Method',
				returns: 'Instance?',
				description: 'Finds a child by name. Returns nil if not found.',
				parameters: ['name: string', 'recursive?: boolean'],
				example: 'local child = parent:FindFirstChild("ChildName")'
			},
			'Clone': {
				type: 'Method',
				returns: 'Instance',
				description: 'Creates a copy of the instance and its descendants.',
				example: 'local copy = original:Clone()'
			},
			'Destroy': {
				type: 'Method',
				returns: 'void',
				description: 'Removes the instance from the game permanently.',
				warning: 'Cannot be undone!',
				example: 'part:Destroy()'
			},
			'Connect': {
				type: 'Method',
				returns: 'RBXScriptConnection',
				description: 'Connects a function to an event.',
				parameters: ['callback: function'],
				example: 'connection = event:Connect(function() end)'
			},
			
			// Data Types
			'Vector3': {
				type: 'DataType',
				description: '3D vector representing position or direction.',
				constructors: ['new(x, y, z)', 'FromNormalId()', 'FromAxis()'],
				properties: ['X', 'Y', 'Z', 'Magnitude', 'Unit'],
				example: 'local pos = Vector3.new(10, 5, 0)'
			},
			'CFrame': {
				type: 'DataType',
				description: 'Coordinate frame representing position and rotation.',
				constructors: ['new()', 'lookAt()', 'fromEulerAnglesXYZ()'],
				properties: ['Position', 'LookVector', 'RightVector', 'UpVector'],
				example: 'part.CFrame = CFrame.new(0, 10, 0) * CFrame.Angles(0, math.rad(45), 0)'
			},
			'Color3': {
				type: 'DataType',
				description: 'RGB color value.',
				constructors: ['new(r, g, b)', 'fromRGB(r, g, b)', 'fromHSV(h, s, v)'],
				example: 'part.Color = Color3.fromRGB(255, 128, 0)'
			},
			
			// TweenService
			'TweenService': {
				type: 'Service',
				description: 'Service for creating smooth animations of properties.',
				methods: ['Create'],
				example: 'local tween = TweenService:Create(part, info, {Position = Vector3.new(0,10,0)})'
			},
			'TweenInfo': {
				type: 'DataType',
				description: 'Configuration for tween animations.',
				constructors: ['new(time, style, direction, repeatCount, reverses, delayTime)'],
				example: 'local info = TweenInfo.new(1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)'
			},
			
			// Common Functions
			'print': {
				type: 'Function',
				description: 'Outputs a message to the console.',
				parameters: ['...any'],
				example: 'print("Hello,", playerName)'
			},
			'warn': {
				type: 'Function',
				description: 'Outputs a warning message to the console (yellow text).',
				parameters: ['...any'],
				example: 'warn("This might cause issues!")'
			},
			'error': {
				type: 'Function',
				description: 'Throws an error and stops script execution.',
				parameters: ['message: string', 'level?: number'],
				example: 'error("Invalid input!")'
			},
			'wait': {
				type: 'Function',
				deprecated: true,
				description: 'Legacy wait function. Use task.wait() instead.',
				alternative: 'task.wait()',
				parameters: ['seconds?: number'],
				returns: 'number, number'
			},
			'task': {
				type: 'Library',
				description: 'Modern task scheduler library.',
				methods: ['wait', 'spawn', 'defer', 'delay', 'cancel'],
				example: 'task.wait(1) -- Better than wait(1)'
			},
			'spawn': {
				type: 'Function',
				deprecated: true,
				description: 'Legacy async function. Use task.spawn() instead.',
				alternative: 'task.spawn()',
				parameters: ['function'],
				example: 'task.spawn(function() end)'
			}
		};
		
		// Enhanced LuaU Snippets Collection
		function createEnhancedLuauSnippets() {
			return [
				// === CORE ROBLOX ===
				{
					label: 'game:GetService',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:ServiceName} = game:GetService("${1:ServiceName}")',
					documentation: 'Get a Roblox service',
					detail: 'Service getter'
				},
				{
					label: 'Services Bundle',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: '-- Services\nlocal Players = game:GetService("Players")\nlocal ReplicatedStorage = game:GetService("ReplicatedStorage")\nlocal RunService = game:GetService("RunService")\nlocal TweenService = game:GetService("TweenService")\nlocal Debris = game:GetService("Debris")\n',
					documentation: 'Common services bundle',
					detail: 'Import multiple services'
				},
				
				// === REMOTE EVENTS ===
				{
					label: 'RemoteEvent Server',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:remoteName} = ReplicatedStorage:WaitForChild("${1:remoteName}")\n\n${1:remoteName}.OnServerEvent:Connect(function(player, ${2:...})\n\t${3:-- Server logic here}\nend)',
					documentation: 'Server-side RemoteEvent handler',
					detail: 'Handle client-to-server communication'
				},
				{
					label: 'RemoteEvent Client',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:remoteName} = ReplicatedStorage:WaitForChild("${1:remoteName}")\n\n${1:remoteName}.OnClientEvent:Connect(function(${2:...})\n\t${3:-- Client logic here}\nend)',
					documentation: 'Client-side RemoteEvent handler',
					detail: 'Handle server-to-client communication'
				},
				{
					label: 'RemoteFunction Server',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:functionName} = ReplicatedStorage:WaitForChild("${1:functionName}")\n\n${1:functionName}.OnServerInvoke = function(player, ${2:...})\n\t${3:-- Process and return data}\n\treturn ${4:result}\nend',
					documentation: 'Server-side RemoteFunction',
					detail: 'Two-way communication with return value'
				},
				
				// === PLAYER HANDLING ===
				{
					label: 'PlayerAdded',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'Players.PlayerAdded:Connect(function(player)\n\t${1:-- Initialize player}\n\t\n\tplayer.CharacterAdded:Connect(function(character)\n\t\t${2:-- Character spawned}\n\t\tlocal humanoid = character:WaitForChild("Humanoid")\n\t\t\n\t\thumanoid.Died:Connect(function()\n\t\t\t${3:-- Character died}\n\t\tend)\n\tend)\nend)',
					documentation: 'Complete player join handler with character events',
					detail: 'Player lifecycle management'
				},
				{
					label: 'Leaderstats',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local function createLeaderstats(player)\n\tlocal leaderstats = Instance.new("Folder")\n\tleaderstats.Name = "leaderstats"\n\tleaderstats.Parent = player\n\t\n\tlocal ${1:coins} = Instance.new("IntValue")\n\t${1:coins}.Name = "${1:Coins}"\n\t${1:coins}.Value = ${2:0}\n\t${1:coins}.Parent = leaderstats\n\t\n\tlocal ${3:level} = Instance.new("IntValue")\n\t${3:level}.Name = "${3:Level}"\n\t${3:level}.Value = ${4:1}\n\t${3:level}.Parent = leaderstats\nend\n\nPlayers.PlayerAdded:Connect(createLeaderstats)',
					documentation: 'Create player leaderstats',
					detail: 'Leaderboard setup'
				},
				
				// === TWEENING ===
				{
					label: 'TweenPosition',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local TweenService = game:GetService("TweenService")\n\nlocal ${1:part} = ${2:workspace.Part}\nlocal tweenInfo = TweenInfo.new(\n\t${3:1}, -- Duration\n\tEnum.EasingStyle.${4:Quad},\n\tEnum.EasingDirection.${5:Out},\n\t${6:0}, -- RepeatCount\n\t${7:false}, -- Reverses\n\t${8:0} -- DelayTime\n)\n\nlocal tween = TweenService:Create(${1:part}, tweenInfo, {\n\tPosition = Vector3.new(${9:0}, ${10:10}, ${11:0})\n})\n\ntween:Play()',
					documentation: 'Animate part position',
					detail: 'Smooth position animation'
				},
				{
					label: 'TweenMultiple',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local TweenService = game:GetService("TweenService")\n\nlocal ${1:object} = ${2:script.Parent}\nlocal tweenInfo = TweenInfo.new(${3:1}, Enum.EasingStyle.${4:Quad}, Enum.EasingDirection.${5:Out})\n\nlocal goals = {\n\tPosition = Vector3.new(${6:0}, ${7:10}, ${8:0}),\n\tTransparency = ${9:0.5},\n\tSize = Vector3.new(${10:4}, ${11:4}, ${12:4}),\n\tColor = Color3.fromRGB(${13:255}, ${14:128}, ${15:0})\n}\n\nlocal tween = TweenService:Create(${1:object}, tweenInfo, goals)\ntween:Play()',
					documentation: 'Animate multiple properties',
					detail: 'Complex animation'
				},
				
				// === LOOPS & CONNECTIONS ===
				{
					label: 'Heartbeat Loop',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local RunService = game:GetService("RunService")\n\nlocal connection\nconnection = RunService.Heartbeat:Connect(function(deltaTime)\n\t${1:-- Update logic (60 FPS)}\n\t\n\t-- Stop condition example:\n\tif ${2:false} then\n\t\tconnection:Disconnect()\n\tend\nend)',
					documentation: 'Game loop running every frame',
					detail: '~60Hz update loop'
				},
				{
					label: 'While Loop Safe',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:isRunning} = true\n\ntask.spawn(function()\n\twhile ${1:isRunning} do\n\t\t${2:-- Loop logic}\n\t\ttask.wait(${3:0.1}) -- Prevent infinite loop crash\n\tend\nend)',
					documentation: 'Safe while loop with task.wait',
					detail: 'Non-blocking loop'
				},
				
				// === RAYCASTING ===
				{
					label: 'Raycast',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local rayOrigin = ${1:Vector3.new(0, 10, 0)}\nlocal rayDirection = ${2:Vector3.new(0, -100, 0)}\n\nlocal raycastParams = RaycastParams.new()\nraycastParams.FilterType = Enum.RaycastFilterType.${3:Exclude}\nraycastParams.FilterDescendantsInstances = {${4:character}}\nraycastParams.IgnoreWater = ${5:true}\n\nlocal raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)\n\nif raycastResult then\n\tlocal hitPart = raycastResult.Instance\n\tlocal hitPosition = raycastResult.Position\n\tlocal hitNormal = raycastResult.Normal\n\t${6:-- Handle hit}\nend',
					documentation: 'Modern raycasting with filters',
					detail: 'Advanced raycast setup'
				},
				
				// === MODULE SCRIPTS ===
				{
					label: 'ModuleScript',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:ModuleName} = {}\n${1:ModuleName}.__index = ${1:ModuleName}\n\nfunction ${1:ModuleName}.new(${2:...})\n\tlocal self = setmetatable({}, ${1:ModuleName})\n\t${3:-- Initialize}\n\treturn self\nend\n\nfunction ${1:ModuleName}:${4:methodName}(${5:...})\n\t${6:-- Method logic}\nend\n\nreturn ${1:ModuleName}',
					documentation: 'Object-oriented module template',
					detail: 'OOP pattern'
				},
				
				// === DATA PERSISTENCE ===
				{
					label: 'DataStore',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local DataStoreService = game:GetService("DataStoreService")\nlocal dataStore = DataStoreService:GetDataStore("${1:PlayerData}")\n\nlocal function saveData(player)\n\tlocal key = "Player_" .. player.UserId\n\tlocal data = {\n\t\t${2:coins = player.leaderstats.Coins.Value,}\n\t\t${3:level = player.leaderstats.Level.Value}\n\t}\n\t\n\tlocal success, err = pcall(function()\n\t\tdataStore:SetAsync(key, data)\n\tend)\n\t\n\tif not success then\n\t\twarn("Failed to save data for " .. player.Name .. ": " .. err)\n\tend\nend\n\nlocal function loadData(player)\n\tlocal key = "Player_" .. player.UserId\n\t\n\tlocal success, data = pcall(function()\n\t\treturn dataStore:GetAsync(key)\n\tend)\n\t\n\tif success and data then\n\t\t${4:-- Apply loaded data}\n\telse\n\t\t${5:-- Use default values}\n\tend\nend',
					documentation: 'DataStore save/load system',
					detail: 'Player data persistence'
				},
				
				// === GUI HANDLING ===
				{
					label: 'GUI Button',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local button = ${1:script.Parent}\nlocal ${2:debounce} = false\n\nbutton.MouseButton1Click:Connect(function()\n\tif ${2:debounce} then return end\n\t${2:debounce} = true\n\t\n\t${3:-- Button action}\n\t\n\ttask.wait(${4:0.5}) -- Cooldown\n\t${2:debounce} = false\nend)\n\n-- Hover effects\nbutton.MouseEnter:Connect(function()\n\tbutton.BackgroundColor3 = Color3.fromRGB(${5:100}, ${6:100}, ${7:100})\nend)\n\nbutton.MouseLeave:Connect(function()\n\tbutton.BackgroundColor3 = Color3.fromRGB(${8:50}, ${9:50}, ${10:50})\nend)',
					documentation: 'Interactive GUI button with hover effects',
					detail: 'Complete button setup'
				},
				
				// === TOOLS & WEAPONS ===
				{
					label: 'Tool Script',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local tool = script.Parent\nlocal handle = tool:WaitForChild("Handle")\n\nlocal player\nlocal character\nlocal humanoid\n\ntool.Equipped:Connect(function()\n\tcharacter = tool.Parent\n\tplayer = game.Players:GetPlayerFromCharacter(character)\n\thumanoid = character:WaitForChild("Humanoid")\n\t${1:-- Tool equipped}\nend)\n\ntool.Activated:Connect(function()\n\t${2:-- Tool used (clicked)}\nend)\n\ntool.Unequipped:Connect(function()\n\t${3:-- Tool unequipped}\nend)',
					documentation: 'Basic tool functionality',
					detail: 'Tool event handlers'
				},
				
				// === TOUCHED EVENTS ===
				{
					label: 'Touched Debounce',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local part = ${1:script.Parent}\nlocal debounce = {}\n\npart.Touched:Connect(function(hit)\n\tlocal humanoid = hit.Parent:FindFirstChildOfClass("Humanoid")\n\tif not humanoid then return end\n\t\n\tlocal player = game.Players:GetPlayerFromCharacter(hit.Parent)\n\tif not player then return end\n\t\n\t-- Debounce per player\n\tif debounce[player] then return end\n\tdebounce[player] = true\n\t\n\t${2:-- Touch action}\n\t\n\ttask.wait(${3:1}) -- Cooldown\n\tdebounce[player] = nil\nend)',
					documentation: 'Touch event with per-player debounce',
					detail: 'Prevents spam activation'
				},
				
				// === REGION3 ===
				{
					label: 'Region3',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local corner1 = Vector3.new(${1:-10}, ${2:0}, ${3:-10})\nlocal corner2 = Vector3.new(${4:10}, ${5:20}, ${6:10})\n\nlocal region = Region3.new(\n\tVector3.new(math.min(corner1.X, corner2.X), math.min(corner1.Y, corner2.Y), math.min(corner1.Z, corner2.Z)),\n\tVector3.new(math.max(corner1.X, corner2.X), math.max(corner1.Y, corner2.Y), math.max(corner1.Z, corner2.Z))\n)\n\nregion = region:ExpandToGrid(4)\n\nlocal parts = workspace:FindPartsInRegion3(region, nil, math.huge)\nfor _, part in ipairs(parts) do\n\t${7:-- Process parts in region}\nend',
					documentation: 'Find parts in 3D region',
					detail: 'Spatial query'
				},
				
				// === COROUTINES ===
				{
					label: 'Coroutine',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local function ${1:asyncFunction}()\n\t${2:-- Async logic}\n\tfor i = 1, ${3:10} do\n\t\tprint("Step", i)\n\t\tcoroutine.yield() -- Pause execution\n\tend\n\treturn ${4:"completed"}\nend\n\nlocal co = coroutine.create(${1:asyncFunction})\n\n-- Resume coroutine\nwhile coroutine.status(co) ~= "dead" do\n\tlocal success, result = coroutine.resume(co)\n\tif not success then\n\t\twarn("Coroutine error:", result)\n\t\tbreak\n\tend\n\ttask.wait(${5:0.1})\nend',
					documentation: 'Coroutine for async operations',
					detail: 'Advanced async pattern'
				},
				
				// === METATABLES ===
				{
					label: 'Metatable Class',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local ${1:ClassName} = {}\n${1:ClassName}.__index = ${1:ClassName}\n\n-- Constructor\nfunction ${1:ClassName}.new(${2:value})\n\tlocal self = setmetatable({}, ${1:ClassName})\n\tself.${3:value} = ${2:value}\n\treturn self\nend\n\n-- Metamethods\nfunction ${1:ClassName}:__tostring()\n\treturn "${1:ClassName}: " .. tostring(self.${3:value})\nend\n\nfunction ${1:ClassName}:__add(other)\n\treturn ${1:ClassName}.new(self.${3:value} + other.${3:value})\nend\n\n-- Methods\nfunction ${1:ClassName}:${4:getValue}()\n\treturn self.${3:value}\nend\n\nreturn ${1:ClassName}',
					documentation: 'Complete class with metamethods',
					detail: 'OOP with operator overloading'
				},
				
				// === PATHFINDING ===
				{
					label: 'Pathfinding',
					kind: monaco.languages.CompletionItemKind.Snippet,
					insertText: 'local PathfindingService = game:GetService("PathfindingService")\n\nlocal ${1:character} = ${2:script.Parent}\nlocal humanoid = ${1:character}:WaitForChild("Humanoid")\nlocal rootPart = ${1:character}:WaitForChild("HumanoidRootPart")\n\nlocal function navigateTo(targetPosition)\n\tlocal path = PathfindingService:CreatePath({\n\t\tAgentRadius = ${3:2},\n\t\tAgentHeight = ${4:5},\n\t\tAgentCanJump = ${5:true},\n\t\tAgentJumpHeight = ${6:7.5},\n\t\tAgentMaxSlope = ${7:45},\n\t\tWaypointSpacing = ${8:4}\n\t})\n\t\n\tpath:ComputeAsync(rootPart.Position, targetPosition)\n\t\n\tif path.Status == Enum.PathStatus.Success then\n\t\tlocal waypoints = path:GetWaypoints()\n\t\t\n\t\tfor _, waypoint in ipairs(waypoints) do\n\t\t\thumanoid:MoveTo(waypoint.Position)\n\t\t\t\n\t\t\tif waypoint.Action == Enum.PathWaypointAction.Jump then\n\t\t\t\thumanoid.Jump = true\n\t\t\tend\n\t\t\t\n\t\t\thumanoid.MoveToFinished:Wait()\n\t\tend\n\telse\n\t\twarn("Path not found!")\n\tend\nend\n\nnavigateTo(Vector3.new(${9:0}, ${10:0}, ${11:0}))',
					documentation: 'AI pathfinding system',
					detail: 'NPC navigation'
				}
			];
		}
		
		// Fast element caching with requestAnimationFrame
		function cacheElements(){
			requestAnimationFrame(()=>{
				els.sidebar=document.getElementById('sidebar');
				els.statusText=document.getElementById('statusText');
				els.currentLine=document.getElementById('currentLine');
				els.currentCol=document.getElementById('currentCol');
				els.loadingOverlay=document.getElementById('loadingOverlay');
				els.editorContainer=document.getElementById('editorContainer');
				els.customNotification=document.getElementById('customNotification');
				els.notificationText=document.getElementById('notificationText');
			});
		}
		
		function showError(msg){
			const errorDiv=document.createElement('div');
			errorDiv.className='error-message';
			errorDiv.innerHTML=`<h3>Loading Error</h3><p>${msg}</p>`;
			document.body.appendChild(errorDiv);
			if(els.loadingOverlay)els.loadingOverlay.style.display='none';
		}
		
		function showNotification(msg,duration=2500){
			if(!els.customNotification||!els.notificationText)return;
			els.notificationText.textContent=msg;
			els.customNotification.classList.add('show');
			clearTimeout(notificationTimeout);
			notificationTimeout=setTimeout(()=>hideNotification(),duration);
		}
		
		function hideNotification(){
			if(els.customNotification)els.customNotification.classList.remove('show');
		}
		
		function updateStatus(text,duration=1500){
			if(!els.statusText)return;
			els.statusText.textContent=text;
			clearTimeout(statusTimeout);
			statusTimeout=setTimeout(()=>{
				if(els.statusText&&editorLoaded)els.statusText.textContent='Ready';
			},duration);
		}
		
		function hideLoadingOverlay(){
			if(els.loadingOverlay){
				els.loadingOverlay.style.opacity='0';
				setTimeout(()=>{
					els.loadingOverlay.style.display='none';
					els.editorContainer.classList.add('loaded');
				},200);
			}
		}
		
		// Faster Monaco initialization
		require.config({paths:{'vs':'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.41.0/min/vs'}});
		
		require(['vs/editor/editor.main'],function(){
			try{
				updateStatus('Loading...');
				
				// Lightweight theme with syntax highlighting
				monaco.editor.defineTheme('EnhancedLuauTheme',{
					base:'vs-dark',
					inherit:true,
					rules:[
						{token:'comment',foreground:'6c7086',fontStyle:'italic'},
						{token:'keyword',foreground:'cba6f7',fontStyle:'bold'},
						{token:'string',foreground:'a6e3a1'},
						{token:'number',foreground:'fab387'},
						{token:'function',foreground:'f38ba8'},
						{token:'variable',foreground:'89dceb'},
						{token:'type',foreground:'f9e2af'},
						{token:'constant',foreground:'f5c2e7'}
					],
					colors:{
						'editor.background':'#202020',
						'editor.foreground':'#cdd6f4',
						'editorCursor.foreground':'#f5e0dc',
						'editor.lineHighlightBackground':'#303030',
						'editorLineNumber.foreground':'#6c7086',
						'editor.selectionBackground':'#45475a',
						'editor.inactiveSelectionBackground':'#313244'
					}
				});
				
				// Register enhanced completion provider
				monaco.languages.registerCompletionItemProvider('lua', {
					provideCompletionItems: (model, position) => {
						if(!autoCompletionEnabled) return {suggestions:[]};
						
						const word = model.getWordUntilPosition(position);
						const range = {
							startLineNumber: position.lineNumber,
							endLineNumber: position.lineNumber,
							startColumn: word.startColumn,
							endColumn: word.endColumn
						};
						
						const suggestions = createEnhancedLuauSnippets().map(item => ({
							...item,
							range,
							insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet
						}));
						
						return {suggestions};
					},
					triggerCharacters: ['.', ':', '"']
				});
				
				// Register hover provider for documentation
				monaco.languages.registerHoverProvider('lua', {
					provideHover: function(model, position) {
						if(!typeHintsEnabled) return null;
						
						const word = model.getWordAtPosition(position);
						if (!word) return null;
						
						const docs = robloxAPIDocs[word.word];
						if (!docs) return null;
						
						let contents = [`**${word.word}**`];
						
						if (docs.type) {
							contents.push({value: `*Type: ${docs.type}*`, isTrusted: true});
						}
						
						if (docs.deprecated) {
							contents.push({value: `⚠️ **Deprecated** - Use \`${docs.alternative}\` instead`, isTrusted: true});
						}
						
						if (docs.description) {
							contents.push({value: docs.description, isTrusted: true});
						}
						
						if (docs.parameters) {
							contents.push({value: `**Parameters:** ${docs.parameters.join(', ')}`, isTrusted: true});
						}
						
						if (docs.returns) {
							contents.push({value: `**Returns:** ${docs.returns}`, isTrusted: true});
						}
						
						if (docs.properties) {
							contents.push({value: `**Properties:** ${docs.properties.join(', ')}`, isTrusted: true});
						}
						
						if (docs.methods) {
							contents.push({value: `**Methods:** ${docs.methods.join(', ')}`, isTrusted: true});
						}
						
						if (docs.events) {
							contents.push({value: `**Events:** ${docs.events.join(', ')}`, isTrusted: true});
						}
						
						if (docs.example) {
							contents.push({value: '```lua\n' + docs.example + '\n```', isTrusted: true});
						}
						
						if (docs.warning) {
							contents.push({value: `⚠️ **Warning:** ${docs.warning}`, isTrusted: true});
						}
						
						return {
							contents: contents,
							range: new monaco.Range(
								position.lineNumber,
								word.startColumn,
								position.lineNumber,
								word.endColumn
							)
						};
					}
				});
				
				// Register signature help provider
				monaco.languages.registerSignatureHelpProvider('lua', {
					signatureHelpTriggerCharacters: ['(', ','],
					provideSignatureHelp: (model, position) => {
						const textUntilPosition = model.getValueInRange({
							startLineNumber: position.lineNumber,
							startColumn: 1,
							endLineNumber: position.lineNumber,
							endColumn: position.column
						});
						
						// Simple signature detection for common functions
						const signatures = {
							'Vector3.new': {
								label: 'Vector3.new(x: number, y: number, z: number)',
								parameters: [
									{ label: 'x: number', documentation: 'X coordinate' },
									{ label: 'y: number', documentation: 'Y coordinate' },
									{ label: 'z: number', documentation: 'Z coordinate' }
								]
							},
							'CFrame.new': {
								label: 'CFrame.new(x: number, y: number, z: number)',
								parameters: [
									{ label: 'x: number', documentation: 'X position' },
									{ label: 'y: number', documentation: 'Y position' },
									{ label: 'z: number', documentation: 'Z position' }
								]
							},
							'TweenInfo.new': {
								label: 'TweenInfo.new(time: number, easingStyle?: Enum.EasingStyle, easingDirection?: Enum.EasingDirection, repeatCount?: number, reverses?: boolean, delayTime?: number)',
								parameters: [
									{ label: 'time: number', documentation: 'Duration in seconds' },
									{ label: 'easingStyle?: Enum.EasingStyle', documentation: 'Animation curve type' },
									{ label: 'easingDirection?: Enum.EasingDirection', documentation: 'Direction of easing' },
									{ label: 'repeatCount?: number', documentation: 'Times to repeat (-1 for infinite)' },
									{ label: 'reverses?: boolean', documentation: 'Whether to reverse animation' },
									{ label: 'delayTime?: number', documentation: 'Delay before starting' }
								]
							}
						};
						
						for (const [func, sig] of Object.entries(signatures)) {
							if (textUntilPosition.includes(func + '(')) {
								return {
									activeSignature: 0,
									activeParameter: 0,
									signatures: [{
										label: sig.label,
										parameters: sig.parameters
									}]
								};
							}
						}
						
						return null;
					}
				});
				
				// Minimal editor config for fast loading
				const editorConfig={
					language:'lua',
					theme:'EnhancedLuauTheme',
					automaticLayout:true,
					minimap:{enabled:false},
					fontSize:12,
					fontFamily:'Cascadia Code,Fira Code,consolas,monospace',
					scrollBeyondLastLine:false,
					renderLineHighlight:'line',
					wordWrap:'off',
					smoothScrolling:false,
					cursorBlinking:'solid',
					suggest:{
						showKeywords:true,
						showSnippets:true,
						localityBonus:true,
						snippetsPreventQuickSuggestions:false
					},
					quickSuggestions:{
						other:true,
						comments:false,
						strings:true
					},
					parameterHints:{
						enabled:true
					},
					scrollbar:{useShadows:false}
				};
				
				editor=monaco.editor.create(document.getElementById('container'),editorConfig);
				
				// Throttled cursor position updates
				let lastUpdate=0;
				editor.onDidChangeCursorPosition((e)=>{
					const now=Date.now();
					if(now-lastUpdate>50){ // 20fps max
						if(els.currentLine&&els.currentCol){
							els.currentLine.textContent=e.position.lineNumber;
							els.currentCol.textContent=e.position.column;
						}
						lastUpdate=now;
					}
				});
				
				let changeTimeout;
				editor.onDidChangeModelContent(()=>{
					clearTimeout(changeTimeout);
					changeTimeout=setTimeout(()=>updateStatus('Auto-saved',1000),1000);
				});
				
				// Notify C# that editor is ready
				if(window.chrome && window.chrome.webview){
					window.chrome.webview.postMessage('EDITOR_READY');
				}
				
				editorLoaded=true;
				hideLoadingOverlay();
				updateStatus('Ready');
			}catch(error){
				console.error('Editor error:',error);
				showError(`Failed to load editor: ${error.message}`);
			}
		},function(error){
			console.error('Monaco error:',error);
			showError('Failed to load Monaco Editor. Check your connection.');
		});
		
		// Throttled resize handler
		let resizeTimeout;
		window.addEventListener('resize',function(){
			clearTimeout(resizeTimeout);
			resizeTimeout=setTimeout(()=>{
				if(editorLoaded&&editor)editor.layout();
			},150);
		});
		
		// UI Functions
		window.toggleSidebar=()=>els.sidebar?.classList.toggle('open');
		
		window.toggleMinimap=function(){
			if(!editorLoaded)return;
			const minimapEnabled=editor.getOptions().get(monaco.editor.EditorOption.minimap).enabled;
			editor.updateOptions({minimap:{enabled:!minimapEnabled}});
			const button=document.querySelector('[onclick="toggleMinimap()"]');
			if(button)button.classList.toggle('active');
			showNotification(minimapEnabled?'Minimap disabled':'Minimap enabled');
		}
		
		window.changeFontSize=function(size){
			if(!editorLoaded)return;
			editor.updateOptions({fontSize:parseInt(size)});
			showNotification(`Font size: ${size}px`);
		}
		
		window.changeLineHeight=function(height){
			if(!editorLoaded)return;
			editor.updateOptions({lineHeight:parseFloat(height)});
			showNotification(`Line height: ${height}`);
		}
		
		window.toggleWordWrap=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const wordWrap=element.classList.contains('active');
			editor.updateOptions({wordWrap:wordWrap?'on':'off'});
			showNotification(`Word wrap ${wordWrap?'enabled':'disabled'}`);
		}
		
		window.toggleLineNumbers=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const lineNumbers=element.classList.contains('active');
			editor.updateOptions({lineNumbers:lineNumbers?'on':'off'});
			showNotification(`Line numbers ${lineNumbers?'enabled':'disabled'}`);
		}
		
		window.toggleAutoSave=function(element){
			element.classList.toggle('active');
			const autoSave=element.classList.contains('active');
			showNotification(`Auto-save ${autoSave?'enabled':'disabled'}`);
		}
		
		window.toggleAutoCompletion=function(element){
			element.classList.toggle('active');
			autoCompletionEnabled=element.classList.contains('active');
			showNotification(`Auto completion ${autoCompletionEnabled?'enabled':'disabled'}`);
		}
		
		window.toggleErrorDetection=function(element){
			if(!editorLoaded)return;
			element.classList.toggle('active');
			const enabled=element.classList.contains('active');
			editor.updateOptions({renderValidationDecorations:enabled?'on':'off'});
			showNotification(`Error detection ${enabled?'enabled':'disabled'}`);
		}
		
		window.toggleTypeHints=function(element){
			element.classList.toggle('active');
			typeHintsEnabled=element.classList.contains('active');
			showNotification(`Type hints ${typeHintsEnabled?'enabled':'disabled'}`);
		}
		
		// Show snippets library
		window.showSnippets=function(){
			if(!editorLoaded)return;
			showNotification('Press Ctrl+Space to view all snippets', 3000);
			editor.trigger('', 'editor.action.triggerSuggest', {});
		}
		
		// API Functions for C# integration
		window.GetText=function(){return editorLoaded?editor.getValue():'';}
		window.SetText=function(text){if(editorLoaded)editor.setValue(text||'');}
		window.SetTheme=function(theme){
			if(editorLoaded){
				monaco.editor.setTheme(theme==='Dark'?'EnhancedLuauTheme':'vs');
			}
		}
		window.hideNotification=hideNotification;
		
		// Keyboard shortcuts
		document.addEventListener('keydown',function(e){
			if(e.ctrlKey&&e.key==='s'){
				e.preventDefault();
				showNotification('Auto-save enabled');
			}
			if(e.key==='Escape'){
				if(els.sidebar?.classList.contains('open')){
					toggleSidebar();
				}else if(els.customNotification?.classList.contains('show')){
					hideNotification();
				}
			}
			if(e.ctrlKey&&e.shiftKey&&e.key==='F'){
				e.preventDefault();
				if(editorLoaded){
					editor.getAction('editor.action.formatDocument').run();
					showNotification('Code formatted');
				}
			}
			if(e.ctrlKey&&e.key===' '){
				e.preventDefault();
				if(editorLoaded){
					editor.trigger('', 'editor.action.triggerSuggest', {});
				}
			}
		});
		
		// Initialize
		document.addEventListener('DOMContentLoaded',cacheElements);
	</script>
</body>
</html>